<h1 id="python-merge-csv-files">Python Merge CSV files</h1>
<h2 id="this-program-reads-a-list-of-csv-files-in-the-given-path-consolidates-the-contents-and-creates-a-new-single-file">This program reads a list of csv files in the given path, consolidates the contents and creates a new single file</h2>
<p>24 Aug 2020</p>
<h2 id="import-required-header-files">1. Import required header files</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> csv</span></code></pre></div>
<h2 id="get-the-list-of-csv-files-in-the-given-pathdirectory">2. get the list of CSV files in the given path/directory</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>csv_files <span class="op">=</span> []</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#get the list of csv files</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>path <span class="op">=</span> os.path.join(<span class="st">&quot;c:</span><span class="ch">\\</span><span class="st">&quot;</span>,<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">csv&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(path):</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb2-6"><a href="#cb2-6"></a>       <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&quot;.csv&quot;</span>):</span>
<span id="cb2-7"><a href="#cb2-7"></a>           csv_files.append(root <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span><span class="op">+</span> <span class="bu">file</span>)</span></code></pre></div>
<h2 id="loop-through-the-csv-files-open-them-and-read-the-contents">3. Loop through the CSV file(s), open them and read the contents</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>data <span class="op">=</span> []</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#loop through the csv files, open  and read them</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="cf">for</span> path <span class="kw">in</span> csv_files:</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="co"># file = open(path, newline=&quot;\n&quot;)</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="cf">with</span> <span class="bu">open</span>(path, newline<span class="op">=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) <span class="im">as</span> inputfile:</span>
<span id="cb3-6"><a href="#cb3-6"></a>        reader <span class="op">=</span> csv.reader(inputfile)</span>
<span id="cb3-7"><a href="#cb3-7"></a>        header <span class="op">=</span> <span class="bu">next</span>(reader)   <span class="co">#skip the header</span></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a>        <span class="cf">for</span> row <span class="kw">in</span> reader:</span>
<span id="cb3-10"><a href="#cb3-10"></a>            owner <span class="op">=</span> path.split(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>)[<span class="op">-</span><span class="dv">1</span>].split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb3-11"><a href="#cb3-11"></a>            script <span class="op">=</span> row[<span class="dv">1</span>]</span>
<span id="cb3-12"><a href="#cb3-12"></a>            qty_stocks <span class="op">=</span> <span class="bu">float</span>(row[<span class="dv">2</span>])</span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a>            data.append([owner, script, qty_stocks])</span></code></pre></div>
<h2 id="write-the-the-contents-of-the-file-and-print-them">4. write the the contents of the file and print them</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#print the contents of the file, write the contents in file</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>path <span class="op">=</span> <span class="st">&quot;c:</span><span class="ch">\\</span><span class="st">data</span><span class="ch">\\</span><span class="st">output.csv&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">&#39;w&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> outfile:</span>
<span id="cb4-4"><a href="#cb4-4"></a>    writer <span class="op">=</span> csv.writer(outfile)</span>
<span id="cb4-5"><a href="#cb4-5"></a>    writer.writerow([<span class="st">&quot;Owner&quot;</span>, <span class="st">&quot;Scripts&quot;</span>, <span class="st">&quot;Quantity&quot;</span>])</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="cf">for</span> row <span class="kw">in</span> data:</span>
<span id="cb4-7"><a href="#cb4-7"></a>        writer.writerow(row)</span>
<span id="cb4-8"><a href="#cb4-8"></a>        <span class="bu">print</span>(row)</span></code></pre></div>
<h2 id="note">Note:</h2>
<p>The way Python handles newlines on Windows can result in blank lines appearing between rows when using csv.writer.</p>
<p>In Python 2, opening the file in binary mode disables universal newlines and the data is written properly.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;/pythonwork/thefile_subset11.csv&#39;</span>, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> outfile:</span>
<span id="cb5-2"><a href="#cb5-2"></a>    writer <span class="op">=</span> csv.writer(outfile)</span></code></pre></div>
<p>In Python 3, leave the file in text mode, since youâ€™re writing text, but disable universal newlines.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;/pythonwork/thefile_subset11.csv&#39;</span>, <span class="st">&#39;w&#39;</span>, newline<span class="op">=</span><span class="st">&#39;&#39;</span>) <span class="im">as</span> outfile:</span>
<span id="cb6-2"><a href="#cb6-2"></a>    writer <span class="op">=</span> csv.writer(outfile)</span></code></pre></div>
<p>Reference : <a href="https://sopython.com/canon/97/writing-csv-adds-blank-lines-between-rows">sopython.com</a></p>
